"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[734],{1167:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>h,frontMatter:()=>r,metadata:()=>t,toc:()=>a});const t=JSON.parse('{"id":"HowTo/how_to_export_flowsheet","title":"How to export flowsheet to UI","description":"This API is intended for model developers who would like to connect their flowsheets to the UI.","source":"@site/docs/HowTo/how_to_export_flowsheet.mdx","sourceDirName":"HowTo","slug":"/HowTo/how_to_export_flowsheet","permalink":"/idaes-flowsheet-processor-ui/docs/HowTo/how_to_export_flowsheet","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"title":"How to export flowsheet to UI","sidebar_position":3},"sidebar":"downloadSidebar","previous":{"title":"How to deploy UI installer for developers","permalink":"/idaes-flowsheet-processor-ui/docs/HowTo/how_to_deploy_ui"}}');var s=o(4848),i=o(8453);const r={title:"How to export flowsheet to UI",sidebar_position:3},l="How to add a flowsheet to UI",d={},a=[{value:"Define the <code>export_to_ui</code> function",id:"define-the-export_to_ui-function",level:2},{value:"Required Functions",id:"required-functions",level:2},{value:"<code>do_export</code>",id:"do_export",level:3},{value:"Using the Python API",id:"using-the-python-api",level:4},{value:"Using a CSV file",id:"using-a-csv-file",level:4},{value:"<code>do_build</code>",id:"do_build",level:3},{value:"<code>do_solve</code>",id:"do_solve",level:3},{value:"Additional Options",id:"additional-options",level:2},{value:"Build function using build options",id:"build-function-using-build-options",level:3},{value:"Custom diagram function",id:"custom-diagram-function",level:3},{value:"Enabling UI to Discover Flowsheet",id:"enabling-ui-to-discover-flowsheet",level:2}];function u(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"how-to-add-a-flowsheet-to-ui",children:"How to add a flowsheet to UI"})}),"\n","\n",(0,s.jsx)(n.h1,{id:"add-a-flowsheet-to-the-ui",children:"Add a Flowsheet to the UI"}),"\n",(0,s.jsx)(n.p,{children:'This API is intended for model developers who would like to connect their flowsheets to the UI.\nDevelopers can select which variables to "export" to the UI for each component of the model,\nand provide extra metadata (display name, description) for them. For flowsheets, they should also\nspecify how to build and solve the flowsheets.'}),"\n",(0,s.jsxs)(n.p,{children:["For reference, see ",(0,s.jsx)(n.code,{children:"FlowsheetInterface"})," and ",(0,s.jsx)(n.code,{children:"FlowsheetExport"})," in the ",(0,s.jsx)(n.code,{children:"watertap.ui.fsapi"})," module."]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsxs)(n.h2,{id:"define-the-export_to_ui-function",children:["Define the ",(0,s.jsx)(n.code,{children:"export_to_ui"})," function"]}),"\n",(0,s.jsxs)(n.p,{children:["In some Python module, define the function ",(0,s.jsx)(n.code,{children:"export_to_ui"}),", which will look similar to this:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'from idaes_flowsheet_processor.api import FlowsheetInterface, FlowsheetCategory\n\ndef export_to_ui():\n    return FlowsheetInterface(\n        name="NF-DSPM-DE",\n        do_export=export_variables,\n        do_build=build_flowsheet,\n        do_solve=solve_flowsheet,\n        get_diagram=get_diagram,\n        requires_idaes_solver=True,\n        category=FlowsheetCategory.wastewater,\n        build_options={\n            "Bypass": {\n                "name": "bypass option",\n                "display_name": "With Bypass",\n                "values_allowed": [\'false\', \'true\'],\n                "value": "false"\n            }\n        }\n    )\n'})}),"\n",(0,s.jsx)(n.h2,{id:"required-functions",children:"Required Functions"}),"\n",(0,s.jsx)(n.h3,{id:"do_export",children:(0,s.jsx)(n.code,{children:"do_export"})}),"\n",(0,s.jsx)(n.p,{children:"This function defines the variables that will be displayed on the UI."}),"\n",(0,s.jsx)(n.p,{children:"There are two ways to export the variables:"}),"\n",(0,s.jsx)(n.h4,{id:"using-the-python-api",children:"Using the Python API"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'def export_variables(flowsheet=None, exports=None, build_options=None, **kwargs):\n    fs = flowsheet\n    exports.add(\n        obj=fs.feed.properties[0].flow_vol_phase["Liq"],\n        name="Volumetric flow rate",\n        ui_units=pyunits.L / pyunits.hr,\n        display_units="L/h",\n        rounding=2,\n        description="Inlet volumetric flow rate",\n        is_input=True,\n        input_category="Feed",\n        is_output=False,\n        output_category="Feed",\n    )\n    exports.add(\n        obj=fs.NF.pump.outlet.pressure[0],\n        name="NF pump pressure",\n        ui_units=pyunits.bar,\n        display_units="bar",\n        rounding=2,\n        description="NF pump pressure",\n        is_input=True,\n        input_category="NF design",\n        is_output=True,\n        output_category="NF design",\n    )\n'})}),"\n",(0,s.jsx)(n.h4,{id:"using-a-csv-file",children:"Using a CSV file"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'def export_variables(flowsheet=None, exports=None, build_options=None, **kwargs):\n    exports.from_csv(file="nf_exports.csv", flowsheet=flowsheet)\n'})}),"\n",(0,s.jsx)(n.p,{children:"Example CSV format:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csv",children:'"obj", "name", "descriptions", "ui_units", "display_units", "rounding", "is_input", "input_category", "is_output", "output_category"\n"fs.feed.properties[0].flow_vol_phase[\'Liq\']","Volumetric flow rate","Volumetric flow rate","units.L / units.hr","L/h",2,true,"Feed",false,""\n"fs.NF.pump.outlet.pressure[0]","NF pump pressure","Nanofiltration pump outlet pressure","units.bar","bar",true,"NF design",true,"NF design"\n"fs.NF.product.properties[0].flow_vol_phase[\'Liq\']","NF product volume flow rate","Nanofiltration product volume flow rate","units.L / units.hr","L/h",2,false,"",true,"NF design"\n'})}),"\n",(0,s.jsx)(n.h3,{id:"do_build",children:(0,s.jsx)(n.code,{children:"do_build"})}),"\n",(0,s.jsx)(n.p,{children:"This function defines the build function for a flowsheet."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"from watertap.examples.flowsheets.case_studies.wastewater_resource_recovery.metab.metab import (\n    build,\n    set_operating_conditions,\n    initialize_system,\n    solve,\n    add_costing,\n    adjust_default_parameters,\n)\n\ndef build_flowsheet():\n    m = build()\n    set_operating_conditions(m)\n    assert_degrees_of_freedom(m, 0)\n    assert_units_consistent(m)\n    initialize_system(m)\n    results = solve(m)\n    assert_optimal_termination(results)\n    add_costing(m)\n    assert_degrees_of_freedom(m, 0)\n    m.fs.costing.initialize()\n    adjust_default_parameters(m)\n    results = solve(m)\n    assert_optimal_termination(results)\n    return m\n"})}),"\n",(0,s.jsx)(n.h3,{id:"do_solve",children:(0,s.jsx)(n.code,{children:"do_solve"})}),"\n",(0,s.jsx)(n.p,{children:"This function defines the solve function for a flowsheet."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"from watertap.examples.flowsheets.case_studies.wastewater_resource_recovery.metab.metab import solve\n\ndef solve_flowsheet(flowsheet=None):\n    fs = flowsheet\n    results = solve(fs)\n    return results\n"})}),"\n",(0,s.jsx)(n.h2,{id:"additional-options",children:"Additional Options"}),"\n",(0,s.jsx)(n.h3,{id:"build-function-using-build-options",children:"Build function using build options"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'def build_flowsheet(build_options=None, **kwargs):\n    if build_options is not None:\n        if build_options["Bypass"].value == "true":\n            solver = get_solver()\n            m = nf_with_bypass.build()\n            nf_with_bypass.initialize(m, solver)\n            nf_with_bypass.unfix_opt_vars(m)\n        else:\n            solver = get_solver()\n            m = nf.build()\n            nf.initialize(m, solver)\n            nf.add_objective(m)\n            nf.unfix_opt_vars(m)\n    else:\n        solver = get_solver()\n        m = nf.build()\n        nf.initialize(m, solver)\n        nf.add_objective(m)\n        nf.unfix_opt_vars(m)\n    return m\n'})}),"\n",(0,s.jsx)(n.h3,{id:"custom-diagram-function",children:"Custom diagram function"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'def get_diagram(build_options):\n    if build_options["Bypass"].value == "true":\n        return "nf_with_bypass_ui.png"\n    else:\n        return "nf_ui.png"\n'})}),"\n",(0,s.jsx)(n.h2,{id:"enabling-ui-to-discover-flowsheet",children:"Enabling UI to Discover Flowsheet"}),"\n",(0,s.jsxs)(n.p,{children:["To allow the UI to discover a flowsheet, define an entry point in ",(0,s.jsx)(n.code,{children:"setup.py"})," with the path to the export file:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'entry_points={\n    "watertap.flowsheets": [\n        "nf = watertap.examples.flowsheets.nf_dspmde.nf_ui",\n        "metab = watertap.examples.flowsheets.case_studies.wastewater_resource_recovery.metab.metab_ui",\n    ]\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:["For a complete overview of all arguments, see ",(0,s.jsx)(n.code,{children:"FlowsheetInterface"}),"."]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(u,{...e})}):u(e)}},8453:(e,n,o)=>{o.d(n,{R:()=>r,x:()=>l});var t=o(6540);const s={},i=t.createContext(s);function r(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);